{"version":3,"sources":["Player.js"],"names":["direction","require","cc","Class","extends","Component","properties","jumpHeight","jumpDuration","maxMoveSpeed","accel","jumpAudio","default","type","AudioClip","sayName","console","log","onLoad","_this","director","getCollisionManager","enabled","jumpAction","setJumpAction","xSpeed","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","jump","node","y","runAction","onDestroy","off","event","keyCode","macro","KEY","a","left","accLeft","d","right","accRight","w","up","update","dt","Math","abs","x","changePic","jumpUp","moveBy","v2","easing","easeCubicActionOut","jumpDown","easeCubicActionIn","callback","callFunc","playJumpSound","sequence","audioEngine","playEffect","onCollisionEnter","other","self","world","aabb","preAabb","t","transform","r","radius","p","position","ps","points","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","Sprite","start"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["const direction = require('Global')\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        jumpHeight: 0,\r\n        jumpDuration: 0,\r\n        maxMoveSpeed: 0,\r\n        accel: 0,\r\n        jumpAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n    sayName() {\r\n        console.log(\"牛B\")\r\n    },\r\n    onLoad () {\r\n        const _this = this\r\n        // 开启碰撞检测\r\n        cc.director.getCollisionManager().enabled = true\r\n        // 初始化跳跃动作\r\n        this.jumpAction = this.setJumpAction()\r\n        // 加速度方向开关\r\n        this.xSpeed = 0\r\n        // 初始化键盘输入监听\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this)\r\n        this.jump.on('touchstart', function() {\r\n            _this.node.y <= -158 && _this.node.runAction(_this.jumpAction)\r\n        })\r\n    },\r\n    onDestroy() {\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this)\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this)\r\n    },\r\n    onKeyDown(event) {\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n            case cc.macro.KEY.left:\r\n                direction.accLeft = true\r\n                break\r\n            case cc.macro.KEY.d:\r\n            case cc.macro.KEY.right:\r\n                direction.accRight = true\r\n                break\r\n            case cc.macro.KEY.w:\r\n            case cc.macro.KEY.up:\r\n                this.node.y <= -158 && this.node.runAction(this.jumpAction)\r\n                break;\r\n        }\r\n    },\r\n    onKeyUp(event) {\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n            case cc.macro.KEY.left:\r\n                direction.accLeft = false\r\n                break\r\n            case cc.macro.KEY.d:\r\n            case cc.macro.KEY.right:\r\n                direction.accRight = false\r\n                break\r\n        }\r\n    },\r\n    update(dt) {\r\n        // 根据当前加速度方向美珍更新速度\r\n        if(direction.accLeft) {\r\n            direction.xSpeed -= this.accel * dt\r\n        }else if(direction.accRight) {\r\n            direction.xSpeed += this.accel * dt\r\n        }\r\n        // 限制主角的速度不能超过最大值\r\n        if(Math.abs(direction.xSpeed) > direction.maxMoveSpeed) {\r\n            direction.xSpeed = this.maxMoveSpeed * direction.xSpeed / Math.abs(direction.xSpeed)\r\n        }\r\n        // 根据当前速度更新主角的位置\r\n        this.node.x += direction.xSpeed * dt\r\n        this.changePic()\r\n    },\r\n    setJumpAction() {\r\n         // 跳跃上升\r\n         var jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut());\r\n         // 下落\r\n         var jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn());\r\n         // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法\r\n         var callback = cc.callFunc(this.playJumpSound, this);\r\n         // 不断重复，而且每次完成落地动作后调用回调来播放声音\r\n         return cc.sequence(jumpUp, jumpDown, callback);\r\n    },\r\n    playJumpSound() {\r\n        // 调用声音引擎播放声音\r\n        cc.audioEngine.playEffect(this.jumpAudio, false);\r\n    },\r\n    // 碰撞检测\r\n    onCollisionEnter(other, self) {\r\n        // console.log('on collision enter');\r\n        if(direction.xSpeed > 100 || direction.xSpeed < -100) \r\n            direction.xSpeed = -direction.xSpeed / 2\r\n        else\r\n            this.node.x > 0 ? (direction.xSpeed = -100) : (direction.xSpeed = 100)\r\n        // 碰撞系统会计算出碰撞组件在世界坐标系下的相关的值，并放到 world 这个属性里面\r\n        var world = self.world;\r\n        // 碰撞组件的 aabb 碰撞框\r\n        var aabb = world.aabb;\r\n        // 节点碰撞前上一帧 aabb 碰撞框的位置\r\n        var preAabb = world.preAabb;\r\n        // 碰撞框的世界矩阵\r\n        var t = world.transform;\r\n        // 以下属性为圆形碰撞组件特有属性\r\n        var r = world.radius;\r\n        var p = world.position;\r\n        // 以下属性为 矩形 和 多边形 碰撞组件特有属性\r\n        var ps = world.points;\r\n    },\r\n    changePic() {\r\n        let _this = this\r\n        // 获取当前节点的cc.Sprite\r\n        if(direction.xSpeed < 0 && this.node.y < -158) {\r\n            cc.loader.loadRes('boy_left', cc.SpriteFrame,function(err,spriteFrame){  \r\n                _this.node.getComponent(cc.Sprite).spriteFrame = spriteFrame  \r\n            })  \r\n        }\r\n        if(direction.xSpeed > 0 && this.node.y < -158) {\r\n            cc.loader.loadRes('boy_right', cc.SpriteFrame,function(err,spriteFrame){  \r\n                _this.node.getComponent(cc.Sprite).spriteFrame = spriteFrame  \r\n            })  \r\n        }\r\n        if(direction.xSpeed == 0 && this.node.y < -158) {\r\n            cc.loader.loadRes('boy_stand', cc.SpriteFrame,function(err,spriteFrame){  \r\n                _this.node.getComponent(cc.Sprite).spriteFrame = spriteFrame  \r\n            }) \r\n        }\r\n        if(direction.xSpeed <= 0 && this.node.y >= -158) {\r\n            cc.loader.loadRes('boy_jump_left', cc.SpriteFrame,function(err,spriteFrame){  \r\n                _this.node.getComponent(cc.Sprite).spriteFrame = spriteFrame  \r\n            }) \r\n        }\r\n        if(direction.xSpeed > 0 && this.node.y >= -158) {\r\n            cc.loader.loadRes('boy_jump_right', cc.SpriteFrame,function(err,spriteFrame){  \r\n                _this.node.getComponent(cc.Sprite).spriteFrame = spriteFrame  \r\n            }) \r\n        }\r\n    },\r\n    start () {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}